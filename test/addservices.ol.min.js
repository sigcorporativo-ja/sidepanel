!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=4)}([function(t,e){t.exports='<div class="m-control m-addservices-container">\n    <div id="m-searching-result-addservices" class="m-searching-result g-cartografia-spinner"></div>\n    <div class="title">Cargar servicios WMS</div>\n    \x3c!--         <div id="m-addservices-search" class="search-panel form">\n            <input id="m-addservice-url" type="text" placeholder="URL del servicio" />\n            <button id="m-addservices-btnurl" class="g-cartografia-mas2" title="Añadir WMS"></button>\n        </div> --\x3e\n    \x3c!-- search panel --\x3e\n    <div class="search-panel">\n        <input type="text" id="m-addservices-search-input" placeholder="URL del servicio" class="m-input-search" />\n        <button id="m-addservices-search-btn" class="g-cartografia-zoom m-search-btn" title="Conectar al servicio WMS"></button>\n        <button id="m-addservices-clear-btn" class="g-cartografia-cancelar m-clear-btn" title="Limpiar búsqueda"></button>\n    </div>\n    <div id="m-addservices-results"></div>\n</div>'},function(t,e){t.exports='<div class="results-panels">\n    <div class="table-results">\n        <table>\n            <thead>\n                <tr>\n                    <th>Capa</th>\n                    <th id="m-addservices-selectall">Seleccionar todas</th>\n                </tr>\n            </thead>\n            <tbody>\n                {{#each result}}\n                    <tr>\n                        <td>{{name}}</td>\n                        <td><span id={{name}} class="m-check-addservices g-cartografia-check2"></span></td>\n                    </tr>\n                {{/each}}\n            </tbody>\n        </table>\n        <div class="button">\n            <button class="m-addservices-add"><i class="g-cartografia-subir"></i>Añadir</button>\n        </div>\n    </div>\n</div>'},function(t){t.exports=JSON.parse('{"url":{"name":"addservices","separator":"*"},"constructor":"M.plugin.AddServices","parameters":[{"type":"object","properties":[{"type":"simple","name":"http","position":0},{"type":"simple","name":"https","position":1}]}],"files":{"ol":{"scripts":["addservices.ol.min.js"],"styles":["addservices.ol.min.css"]}},"metadata":{"name":"addservices","description":"Añade servicio WMS","text":"Añade un capa desde un servicio WMS","version":"1.1.1","date":"Abril, 2021","author":"","org":"Instituto de Estadística y Cartografía. Junta de Andalucía","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","centralized":true,"compatibility":["5","6"]}}')},function(t,e,r){},function(t,e,r){"use strict";r.r(e);r(3);function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,r){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(r):i.value}})(t,e,r||t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=u(t);if(e){var i=u(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return l(this,r)}}function l(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(f,M.impl.Control);var e,r,n,l=c(f);function f(){return i(this,f),l.apply(this,arguments)}return e=f,(r=[{key:"addTo",value:function(t,e){this.facadeMap=t,a(u(f.prototype),"addTo",this).call(this,t,e)}},{key:"destroy",value:function(){this.facadeMap.getMapImpl().removeControl(this)}}])&&o(e.prototype,r),n&&o(e,n),f}(),p=r(0),d=r.n(p),h=r(1),v=r.n(h);function y(t){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function b(t,e){return(b=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function g(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=w(t);if(e){var i=w(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return S(this,r)}}function S(t,e){return!e||"object"!==y(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function w(t){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var O=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&b(t,e)}(o,M.Control);var e,r,n,i=g(o);function o(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),M.utils.isUndefined(f)&&M.exception("La implementación usada no puede crear controles AddServicesControl");var r=new f;return(e=i.call(this,r,"AddServices")).stateSelectAll=!1,e.http=t.http,e.https=t.https,e}return e=o,(r=[{key:"addEvents",value:function(t){var e=this;this.urlService=t.querySelector("#m-addservices-search-input"),this.btnAddUrl=t.querySelector("#m-addservices-search-btn"),this.btnClear=t.querySelector("#m-addservices-clear-btn"),this.containerAddservices=t,this.containerSearching=t.querySelector("#m-searching-result-addservices"),this.containerResults=t.querySelector("#m-addservices-results"),this.containerSearch=t.querySelector("#m-addservices-search"),this.btnAddUrl.addEventListener("click",(function(t){return e.readCapabilities(t)})),this.btnClear.addEventListener("click",(function(t){return e.removeContains(t)}))}},{key:"createView",value:function(t){var e=this;return this.facadeMap=t,new Promise((function(t,r){var n=M.template.compileSync(d.a);e.addEvents(n),t(n)}))}},{key:"readCapabilities",value:function(t){var e=this;t.preventDefault();var r=!1,n=!1;if(M.utils.isNullOrEmpty(this.urlService.value))M.dialog.error("Los campos están vacíos.");else if(M.utils.isUrl(this.urlService.value)){var i;this.http&&!this.https?r=/^(http:)/.test(this.urlService.value.trim()):this.https&&!this.http?n=/^(https:)/.test(this.urlService.value.trim()):this.http&&this.https&&(r=!0,n=!0),!0===r||!0===n?(this.containerAddservices.classList.add("m-searching"),M.remote.get(M.utils.getWMSGetCapabilitiesUrl(this.urlService.value)).then((function(t){try{var r=(new M.impl.format.WMSCapabilities).read(t.xml),n=new M.impl.GetCapabilities(r,e.urlService.value,e.facadeMap.getProjection().code);e.capabilities=n.getLayers(),e.showResults()}catch(t){M.dialog.error("Ha ocurrido un error al obtener el documento GetCapabilities.")}e.containerAddservices.classList.remove("m-searching")}))):(this.http?i="Sólo se permiten servicios http":this.https?i="Sólo se permiten servicios https":this.http||this.https||(i="No se permiten servicios http ni https"),M.dialog.error(i))}else M.dialog.error("Debes indicar una URL válida.")}},{key:"showResults",value:function(){var t=this,e=[];this.capabilities.forEach((function(t){e.push(t.getImpl())}));var r=M.template.compileSync(v.a,{vars:{result:e}});this.containerResults.innerHTML=r.innerHTML,M.utils.enableTouchScroll(this.containerResults);for(var n=this.containerResults.getElementsByTagName("span"),i=0;i<n.length;i+=1)n[i].addEventListener("click",(function(e){return t.registerCheck(e)}));this.containerResults.querySelector("#m-addservices-selectall").addEventListener("click",(function(e){return t.registerCheck(e)})),this.containerResults.querySelector(".m-addservices-add").addEventListener("click",(function(e){return t.addLayers(e)}))}},{key:"registerCheck",value:function(t){var e=t||window.event;!M.utils.isNullOrEmpty(e.target)&&e.target.classList.contains("m-check-addservices")?(e.stopPropagation(),e.target.classList.toggle("g-cartografia-check2"),e.target.classList.toggle("g-cartografia-check3"),this.containerResults.querySelectorAll(".g-cartografia-check3").length?this.containerResults.querySelectorAll(".g-cartografia-check2").length||(this.stateSelectAll=!0):this.stateSelectAll=!1):M.utils.isNullOrEmpty(e.target)||"m-addservices-selectall"!==e.target.id||(this.stateSelectAll?(this.unSelect(),this.stateSelectAll=!1):(this.select(),this.stateSelectAll=!0))}},{key:"unSelect",value:function(){for(var t=this.containerResults.querySelectorAll(".g-cartografia-check3"),e=0;e<t.length;e+=1)t[e].classList.remove("g-cartografia-check3"),t[e].classList.add("g-cartografia-check2")}},{key:"select",value:function(){for(var t=this.containerResults.querySelectorAll(".g-cartografia-check2"),e=0;e<t.length;e+=1)t[e].classList.remove("g-cartografia-check2"),t[e].classList.add("g-cartografia-check3")}},{key:"addLayers",value:function(t){t.preventDefault();var e=[],r=this.containerResults.querySelectorAll(".g-cartografia-check3");if(0===r.length)M.dialog.error("Debes seleccionar al menos una capa.");else{for(var n=0;n<r.length;n+=1)for(var i=0;i<this.capabilities.length;i+=1)r[n].id===this.capabilities[i].legend.replace(/ /g,"")&&(this.capabilities[i].options.origen="WMS",e.push(this.capabilities[i]));this.facadeMap.addLayers(e)}}},{key:"removeContains",value:function(t){t.preventDefault(),this.containerResults.innerHTML="",this.urlService.value=""}},{key:"equals",value:function(t){return t instanceof o}}])&&m(e.prototype,r),n&&m(e,n),o}(),_=r(2);function k(t){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function R(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function j(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function A(t,e){return(A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function P(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=L(t);if(e){var i=L(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return C(this,r)}}function C(t,e){return!e||"object"!==k(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function L(t){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var E=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&A(t,e)}(o,M.Plugin);var e,r,n,i=P(o);function o(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return R(this,o),(t=i.call(this)).map_=null,t.controls_=[],t.metadata_=_.metadata,t.http=!1,void 0===e.http||!0!==e.http&&"true"!==e.http||(t.http=!0),t.https=!0,void 0===e.https||!1!==e.https&&"false"!==e.https||(t.https=!1),t}return e=o,(r=[{key:"addTo",value:function(t){var e=this,r={http:this.http,https:this.https},n=new O(r);n.on(M.evt.ADDED_TO_MAP,(function(){e.fire(M.evt.ADDED_TO_MAP)})),this.controls_.push(n),this.map_=t,this.panel_=new M.ui.Panel("panelAddServices",{collapsible:!0,className:"m-addservices",collapsedButtonClass:"g-cartografia-capas",position:M.ui.position.TR,tooltip:"Cargar WMS"}),this.panel_.addControls(this.controls_),this.map_.addPanels(this.panel_)}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_);var t=[null,null,null];this.map_=t[0],this.controls_=t[1],this.panel_=t[2]}},{key:"name",get:function(){return"addservices"}},{key:"getMetadata",value:function(){return this.metadata_}}])&&j(e.prototype,r),n&&j(e,n),o}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.AddServices=E,window.M.control.AddServicesControl=O,window.M.impl.control.AddServicesControl=f}]);
//# sourceMappingURL=addservices.ol.min.js.map